import { Meta } from "@storybook/blocks";
import { ArgsTable } from "@storybook/addon-docs";
import { Dropdown, Typography, Button } from "../index";

<Meta title="molecules/Dropdown/Documentation" />

# Dropdown

The `Dropdown` component is a flexible floating UI element that displays content relative to a trigger element. Built with `@floating-ui/react-dom`, it provides robust positioning, collision detection, and accessibility features for creating menus, tooltips, and other floating content.

## Features

- **Robust Positioning**: Uses floating-ui for intelligent positioning
- **Collision Detection**: Automatically flips and shifts to stay in viewport
- **Portal Rendering**: Renders content in a portal to avoid z-index issues
- **Accessibility**: Proper ARIA attributes and keyboard interactions
- **Flexible Content**: Accept any React element as trigger and content
- **Customizable Behavior**: Control close behavior and positioning options

## Usage

```jsx
import { Dropdown, Button } from "cleanplate";

const App = () => {
  const MenuContent = ({ onClose }) => (
    <div style={{ padding: "var(--space-2)" }}>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        onClick={() => {
          alert("Action clicked!");
          onClose?.();
        }}
      >
        Action
      </Button>
    </div>
  );

  return (
    <Dropdown
      trigger={<Button>Open Menu</Button>}
      content={<MenuContent />}
      placement="bottom-end"
    />
  );
};
```

## Basic Example

```jsx
import React from "react";
import { Dropdown, Button } from "cleanplate";

const BasicDropdown = () => {
  const MenuContent = ({ onClose }) => (
    <div style={{ padding: "var(--space-2)" }}>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        margin="m-0 m-b-1"
        onClick={() => {
          alert("Option 1 clicked!");
          onClose?.();
        }}
      >
        Option 1
      </Button>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        onClick={() => {
          alert("Option 2 clicked!");
          onClose?.();
        }}
      >
        Option 2
      </Button>
    </div>
  );

  return (
    <Dropdown
      trigger={<Button>Menu</Button>}
      content={<MenuContent />}
    />
  );
};
```

## Placement Options

The Dropdown component supports 12 different placement options:

### Top Placements
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="top-start"  // or "top", "top-end"
/>
```

### Bottom Placements
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="bottom-start"  // or "bottom", "bottom-end"
/>
```

### Left Placements
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="left-start"  // or "left", "left-end"
/>
```

### Right Placements
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="right-start"  // or "right", "right-end"
/>
```

## Advanced Configuration

### Custom Offset
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="bottom-end"
  offset={8}  // 8px distance from trigger
/>
```

### Disable Collision Detection
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  placement="top"
  flip={false}  // Don't flip when no space
  shift={false} // Don't shift to stay in viewport
/>
```

### Custom Close Behavior
```jsx
<Dropdown
  trigger={<Button>Menu</Button>}
  content={<MenuContent />}
  closeOnClickOutside={false}  // Don't close on outside click
  closeOnEscape={true}         // Close on Escape key
/>
```

## Real-World Examples

### User Menu
```jsx
const UserMenu = () => {
  const UserMenuContent = ({ onClose }) => (
    <div style={{ padding: "var(--space-2)" }}>
      <div style={{ 
        padding: "var(--space-2) var(--space-1)", 
        borderBottom: "1px solid var(--gray-light)" 
      }}>
        <Typography variant="small" margin="m-0" color="var(--gray)">
          Signed in as
        </Typography>
        <Typography variant="p" margin="m-0" fontWeight="600">
          john.doe@example.com
        </Typography>
      </div>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        margin="m-0 m-t-2 m-b-1"
        onClick={() => {
          // Navigate to dashboard
          onClose?.();
        }}
      >
        Dashboard
      </Button>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        margin="m-0 m-b-1"
        onClick={() => {
          // Navigate to settings
          onClose?.();
        }}
      >
        Settings
      </Button>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        onClick={() => {
          // Sign out
          onClose?.();
        }}
      >
        Sign out
      </Button>
    </div>
  );

  return (
    <Dropdown
      trigger={
        <Button variant="outline">
          <div style={{ display: "flex", alignItems: "center", gap: "var(--space-2)" }}>
            <div style={{ 
              width: "24px", 
              height: "24px", 
              borderRadius: "50%", 
              backgroundColor: "var(--primary-brand)",
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              color: "white",
              fontSize: "12px",
              fontWeight: "600"
            }}>
              JD
            </div>
            <Typography variant="small">John Doe</Typography>
          </div>
        </Button>
      }
      content={<UserMenuContent />}
      placement="bottom-end"
      offset={8}
    />
  );
};
```

### Action Menu
```jsx
const ActionMenu = () => {
  const ActionMenuContent = ({ onClose }) => (
    <div style={{ padding: "var(--space-2)" }}>
      <Typography variant="small" margin="m-0 m-b-2" color="var(--gray)">
        Actions
      </Typography>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        margin="m-0 m-b-1"
        onClick={() => {
          // Edit action
          onClose?.();
        }}
      >
        Edit
      </Button>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        margin="m-0 m-b-1"
        onClick={() => {
          // Duplicate action
          onClose?.();
        }}
      >
        Duplicate
      </Button>
      <Button 
        variant="outline" 
        size="small" 
        isFluid 
        onClick={() => {
          // Delete action
          onClose?.();
        }}
      >
        Delete
      </Button>
    </div>
  );

  return (
    <div style={{ display: "flex", gap: "var(--space-3)" }}>
      <Button>Primary Action</Button>
      <Dropdown
        trigger={<Button variant="outline">More Actions</Button>}
        content={<ActionMenuContent />}
        placement="bottom-start"
      />
    </div>
  );
};
```

## Behavior

### Default Behavior
- **Placement**: `bottom-end` (bottom-right of trigger)
- **Offset**: `4px` distance from trigger
- **Flip**: `true` (flips to opposite side when no space)
- **Shift**: `true` (shifts to stay within viewport)
- **Close on Outside Click**: `true`
- **Close on Escape**: `true`

### Interaction Handling
- **Click Trigger**: Opens/closes dropdown
- **Click Outside**: Closes dropdown (if enabled)
- **Escape Key**: Closes dropdown (if enabled)
- **Content Actions**: Use `onClose` prop to close dropdown

## Best Practices

1. **Use Semantic Content**: Structure your dropdown content logically
2. **Handle Close Actions**: Always call `onClose` when actions are performed
3. **Choose Appropriate Placement**: Consider available space and user flow
4. **Test on Mobile**: Ensure dropdowns work well on touch devices
5. **Provide Clear Labels**: Use descriptive text for menu items
6. **Consider Accessibility**: Ensure keyboard navigation works properly

## Accessibility

The Dropdown component includes comprehensive accessibility features:

- **ARIA Attributes**: Proper `role`, `aria-expanded`, `aria-haspopup` attributes
- **Keyboard Navigation**: Escape key support for closing
- **Focus Management**: Maintains focus on trigger element
- **Screen Reader Support**: Proper announcements and labeling
- **Portal Rendering**: Avoids z-index and overflow issues

## Props

<ArgsTable of={Dropdown} />
